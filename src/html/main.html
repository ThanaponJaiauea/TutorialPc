<div id="main" class="positionZero">
  <div id="body_main" class="bgSizeCover"></div>

  <div id="menu_main" style="width: 100%">
    <div id="menu_main_content" class="bg-foot-all coverMenu">
      <div id="menu_home" class="menuCss menuDiv">
        <div class="menuCss_pic">
          <div class="menuOnClass" id="menuHome">
            <svg
              width="30"
              height="29"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M12.1361 1.21065C12.4972 0.929784 13.0028 0.929784 13.3639 1.21065L22.3639 8.21065C22.6075 8.4001 22.75 8.69141 22.75 9V20C22.75 20.7957 22.4339 21.5587 21.8713 22.1213C21.3087 22.6839 20.5457 23 19.75 23H5.75C4.95435 23 4.19129 22.6839 3.62868 22.1213C3.06607 21.5587 2.75 20.7957 2.75 20V9C2.75 8.69141 2.89247 8.4001 3.13606 8.21065L12.1361 1.21065ZM4.75 9.48908V20C4.75 20.2652 4.85536 20.5196 5.04289 20.7071C5.23043 20.8946 5.48478 21 5.75 21H19.75C20.0152 21 20.2696 20.8946 20.4571 20.7071C20.6446 20.5196 20.75 20.2652 20.75 20V9.48908L12.75 3.26686L4.75 9.48908Z"
                fill="var(--bg-foot)"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M8.75 12C8.75 11.4477 9.19772 11 9.75 11H15.75C16.3023 11 16.75 11.4477 16.75 12V22C16.75 22.5523 16.3023 23 15.75 23C15.1977 23 14.75 22.5523 14.75 22V13H10.75V22C10.75 22.5523 10.3023 23 9.75 23C9.19772 23 8.75 22.5523 8.75 22V12Z"
                fill="var(--bg-foot)"
              />
            </svg>
          </div>
          <div class="menuOffClass" id="menuHome2" style="display: none">
            <svg
              width="28"
              height="27"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M12.1361 1.21065C12.4972 0.929784 13.0028 0.929784 13.3639 1.21065L22.3639 8.21065C22.6075 8.4001 22.75 8.69141 22.75 9V20C22.75 20.7957 22.4339 21.5587 21.8713 22.1213C21.3087 22.6839 20.5457 23 19.75 23H5.75C4.95435 23 4.19129 22.6839 3.62868 22.1213C3.06607 21.5587 2.75 20.7957 2.75 20V9C2.75 8.69141 2.89247 8.4001 3.13606 8.21065L12.1361 1.21065ZM4.75 9.48908V20C4.75 20.2652 4.85536 20.5196 5.04289 20.7071C5.23043 20.8946 5.48478 21 5.75 21H19.75C20.0152 21 20.2696 20.8946 20.4571 20.7071C20.6446 20.5196 20.75 20.2652 20.75 20V9.48908L12.75 3.26686L4.75 9.48908Z"
                fill="#97979B"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M8.75 12C8.75 11.4477 9.19772 11 9.75 11H15.75C16.3023 11 16.75 11.4477 16.75 12V22C16.75 22.5523 16.3023 23 15.75 23C15.1977 23 14.75 22.5523 14.75 22V13H10.75V22C10.75 22.5523 10.3023 23 9.75 23C9.19772 23 8.75 22.5523 8.75 22V12Z"
                fill="#97979B"
              />
            </svg>
          </div>
        </div>
        <span class="menuSpan" id="menuHomeSpan">Home</span>
      </div>

      <div id="menu_trade" class="menuCss menuDiv">
        <div class="menuCss_pic">
          <div class="menuOnClass" id="menuTrade" style="padding-top: 2px">
            <svg
              width="29"
              height="28"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M22.25 10.5V12C22.25 16.714 22.25 19.071 20.785 20.535C19.322 22 16.964 22 12.25 22C7.536 22 5.179 22 3.714 20.535C2.25 19.072 2.25 16.714 2.25 12C2.25 7.286 2.25 4.929 3.714 3.464C5.18 2 7.536 2 12.25 2H13.75"
                stroke="var(--bg-foot)"
                stroke-width="1.5"
                stroke-linecap="round"
              />
              <path
                d="M19.25 8C20.9069 8 22.25 6.65685 22.25 5C22.25 3.34315 20.9069 2 19.25 2C17.5931 2 16.25 3.34315 16.25 5C16.25 6.65685 17.5931 8 19.25 8Z"
                stroke="var(--bg-foot)"
                stroke-width="1.5"
              />
              <path
                d="M7.25 14L9.543 11.707C9.73053 11.5195 9.98484 11.4142 10.25 11.4142C10.5152 11.4142 10.7695 11.5195 10.957 11.707L12.543 13.293C12.7305 13.4805 12.9848 13.5858 13.25 13.5858C13.5152 13.5858 13.7695 13.4805 13.957 13.293L17.25 10M17.25 10V12.5M17.25 10H14.75"
                stroke="var(--bg-foot)"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </div>

          <div
            class="menuOffClass"
            id="menuTrade2"
            style="display: none; padding-top: 2px"
          >
            <svg
              width="27"
              height="26"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M22.25 10.5V12C22.25 16.714 22.25 19.071 20.785 20.535C19.322 22 16.964 22 12.25 22C7.536 22 5.179 22 3.714 20.535C2.25 19.072 2.25 16.714 2.25 12C2.25 7.286 2.25 4.929 3.714 3.464C5.18 2 7.536 2 12.25 2H13.75"
                stroke="#97979B"
                stroke-width="1.5"
                stroke-linecap="round"
              />
              <path
                d="M19.25 8C20.9069 8 22.25 6.65685 22.25 5C22.25 3.34315 20.9069 2 19.25 2C17.5931 2 16.25 3.34315 16.25 5C16.25 6.65685 17.5931 8 19.25 8Z"
                stroke="#97979B"
                stroke-width="1.5"
              />
              <path
                d="M7.25 14L9.543 11.707C9.73053 11.5195 9.98484 11.4142 10.25 11.4142C10.5152 11.4142 10.7695 11.5195 10.957 11.707L12.543 13.293C12.7305 13.4805 12.9848 13.5858 13.25 13.5858C13.5152 13.5858 13.7695 13.4805 13.957 13.293L17.25 10M17.25 10V12.5M17.25 10H14.75"
                stroke="#97979B"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </div>
        </div>
        <span class="menuSpan" id="menuTradeSpan">Trade</span>
      </div>

      <div id="menu_wallet" class="menuCss menuDiv">
        <div class="menuCss_pic">
          <div class="menuOnClass" id="menuwallet">
            <svg
              width="30"
              height="29"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g clip-path="url(#clip0_4834_990)">
                <path
                  d="M18.79 13.55C18.37 13.96 18.13 14.55 18.19 15.18C18.28 16.26 19.27 17.05 20.35 17.05H22.25V18.24C22.25 20.31 20.56 22 18.49 22H7.01C4.94 22 3.25 20.31 3.25 18.24V11.51C3.25 9.44 4.94 7.75 7.01 7.75H18.49C20.56 7.75 22.25 9.44 22.25 11.51V12.95H20.23C19.67 12.95 19.16 13.17 18.79 13.55Z"
                  stroke="var(--bg-foot)"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M3.25 12.4099V7.8399C3.25 6.6499 3.98 5.5899 5.09 5.1699L13.03 2.1699C13.3177 2.06149 13.6274 2.02451 13.9325 2.06213C14.2376 2.09975 14.5291 2.21086 14.7818 2.38591C15.0346 2.56095 15.241 2.79472 15.3835 3.06713C15.5261 3.33954 15.6003 3.64247 15.6 3.9499V7.7499M7.75 11.9999H14.75M23.309 13.9699V16.0299C23.309 16.5799 22.869 17.0299 22.309 17.0499H20.349C19.269 17.0499 18.279 16.2599 18.189 15.1799C18.129 14.5499 18.369 13.9599 18.789 13.5499C19.159 13.1699 19.669 12.9499 20.229 12.9499H22.309C22.869 12.9699 23.309 13.4199 23.309 13.9699Z"
                  stroke="var(--bg-foot)"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </g>
              <defs>
                <clipPath id="clip0_4834_990">
                  <rect
                    width="24"
                    height="24"
                    fill="white"
                    transform="translate(0.75)"
                  />
                </clipPath>
              </defs>
            </svg>
          </div>

          <div class="menuOffClass" id="menuwallet2" style="display: none">
            <svg
              width="28"
              height="27"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g clip-path="url(#clip0_4834_990)">
                <path
                  d="M18.79 13.55C18.37 13.96 18.13 14.55 18.19 15.18C18.28 16.26 19.27 17.05 20.35 17.05H22.25V18.24C22.25 20.31 20.56 22 18.49 22H7.01C4.94 22 3.25 20.31 3.25 18.24V11.51C3.25 9.44 4.94 7.75 7.01 7.75H18.49C20.56 7.75 22.25 9.44 22.25 11.51V12.95H20.23C19.67 12.95 19.16 13.17 18.79 13.55Z"
                  stroke="#97979B"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M3.25 12.4099V7.8399C3.25 6.6499 3.98 5.5899 5.09 5.1699L13.03 2.1699C13.3177 2.06149 13.6274 2.02451 13.9325 2.06213C14.2376 2.09975 14.5291 2.21086 14.7818 2.38591C15.0346 2.56095 15.241 2.79472 15.3835 3.06713C15.5261 3.33954 15.6003 3.64247 15.6 3.9499V7.7499M7.75 11.9999H14.75M23.309 13.9699V16.0299C23.309 16.5799 22.869 17.0299 22.309 17.0499H20.349C19.269 17.0499 18.279 16.2599 18.189 15.1799C18.129 14.5499 18.369 13.9599 18.789 13.5499C19.159 13.1699 19.669 12.9499 20.229 12.9499H22.309C22.869 12.9699 23.309 13.4199 23.309 13.9699Z"
                  stroke="#97979B"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </g>
              <defs>
                <clipPath id="clip0_4834_990">
                  <rect
                    width="24"
                    height="24"
                    fill="white"
                    transform="translate(0.75)"
                  />
                </clipPath>
              </defs>
            </svg>
          </div>
        </div>
        <span class="menuSpan" id="menuwalletSpan">Wallet</span>
      </div>

      <div id="menu_setting" class="menuCss menuDiv">
        <div class="menuCss_pic">
          <div class="menuOnClass" id="menuSetting">
            <svg
              width="30"
              height="29"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M4.71447 15.4645C5.65215 14.5268 6.92392 14 8.25 14H16.25C17.5761 14 18.8479 14.5268 19.7855 15.4645C20.7232 16.4021 21.25 17.6739 21.25 19V21C21.25 21.5523 20.8023 22 20.25 22C19.6977 22 19.25 21.5523 19.25 21V19C19.25 18.2044 18.9339 17.4413 18.3713 16.8787C17.8087 16.3161 17.0456 16 16.25 16H8.25C7.45435 16 6.69129 16.3161 6.12868 16.8787C5.56607 17.4413 5.25 18.2044 5.25 19V21C5.25 21.5523 4.80228 22 4.25 22C3.69772 22 3.25 21.5523 3.25 21V19C3.25 17.6739 3.77678 16.4021 4.71447 15.4645Z"
                fill="var(--bg-foot)"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M12.25 4C10.5931 4 9.25 5.34315 9.25 7C9.25 8.65685 10.5931 10 12.25 10C13.9069 10 15.25 8.65685 15.25 7C15.25 5.34315 13.9069 4 12.25 4ZM7.25 7C7.25 4.23858 9.48858 2 12.25 2C15.0114 2 17.25 4.23858 17.25 7C17.25 9.76142 15.0114 12 12.25 12C9.48858 12 7.25 9.76142 7.25 7Z"
                fill="var(--bg-foot)"
              />
            </svg>
          </div>
          <div class="menuOffClass" id="menuSetting2" style="display: none">
            <svg
              width="28"
              height="27"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M4.71447 15.4645C5.65215 14.5268 6.92392 14 8.25 14H16.25C17.5761 14 18.8479 14.5268 19.7855 15.4645C20.7232 16.4021 21.25 17.6739 21.25 19V21C21.25 21.5523 20.8023 22 20.25 22C19.6977 22 19.25 21.5523 19.25 21V19C19.25 18.2044 18.9339 17.4413 18.3713 16.8787C17.8087 16.3161 17.0456 16 16.25 16H8.25C7.45435 16 6.69129 16.3161 6.12868 16.8787C5.56607 17.4413 5.25 18.2044 5.25 19V21C5.25 21.5523 4.80228 22 4.25 22C3.69772 22 3.25 21.5523 3.25 21V19C3.25 17.6739 3.77678 16.4021 4.71447 15.4645Z"
                fill="#97979B"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M12.25 4C10.5931 4 9.25 5.34315 9.25 7C9.25 8.65685 10.5931 10 12.25 10C13.9069 10 15.25 8.65685 15.25 7C15.25 5.34315 13.9069 4 12.25 4ZM7.25 7C7.25 4.23858 9.48858 2 12.25 2C15.0114 2 17.25 4.23858 17.25 7C17.25 9.76142 15.0114 12 12.25 12C9.48858 12 7.25 9.76142 7.25 7Z"
                fill="#97979B"
              />
            </svg>
          </div>
        </div>
        <span class="menuSpan" id="menuSettingSpan">Setting</span>
      </div>

      <div id="menu_tutorial" class="menuCss menuDiv">
        <div class="menuCss_pic">
          <div class="menuOnClass" id="menuTutorial">
            <svg
              width="30"
              height="29"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M4.71447 15.4645C5.65215 14.5268 6.92392 14 8.25 14H16.25C17.5761 14 18.8479 14.5268 19.7855 15.4645C20.7232 16.4021 21.25 17.6739 21.25 19V21C21.25 21.5523 20.8023 22 20.25 22C19.6977 22 19.25 21.5523 19.25 21V19C19.25 18.2044 18.9339 17.4413 18.3713 16.8787C17.8087 16.3161 17.0456 16 16.25 16H8.25C7.45435 16 6.69129 16.3161 6.12868 16.8787C5.56607 17.4413 5.25 18.2044 5.25 19V21C5.25 21.5523 4.80228 22 4.25 22C3.69772 22 3.25 21.5523 3.25 21V19C3.25 17.6739 3.77678 16.4021 4.71447 15.4645Z"
                fill="var(--bg-foot)"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M12.25 4C10.5931 4 9.25 5.34315 9.25 7C9.25 8.65685 10.5931 10 12.25 10C13.9069 10 15.25 8.65685 15.25 7C15.25 5.34315 13.9069 4 12.25 4ZM7.25 7C7.25 4.23858 9.48858 2 12.25 2C15.0114 2 17.25 4.23858 17.25 7C17.25 9.76142 15.0114 12 12.25 12C9.48858 12 7.25 9.76142 7.25 7Z"
                fill="var(--bg-foot)"
              />
            </svg>
          </div>

          <div class="menuOffClass" id="menuTutorial2" style="display: none">
            <svg
              width="28"
              height="27"
              viewBox="0 0 25 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M4.71447 15.4645C5.65215 14.5268 6.92392 14 8.25 14H16.25C17.5761 14 18.8479 14.5268 19.7855 15.4645C20.7232 16.4021 21.25 17.6739 21.25 19V21C21.25 21.5523 20.8023 22 20.25 22C19.6977 22 19.25 21.5523 19.25 21V19C19.25 18.2044 18.9339 17.4413 18.3713 16.8787C17.8087 16.3161 17.0456 16 16.25 16H8.25C7.45435 16 6.69129 16.3161 6.12868 16.8787C5.56607 17.4413 5.25 18.2044 5.25 19V21C5.25 21.5523 4.80228 22 4.25 22C3.69772 22 3.25 21.5523 3.25 21V19C3.25 17.6739 3.77678 16.4021 4.71447 15.4645Z"
                fill="#97979B"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M12.25 4C10.5931 4 9.25 5.34315 9.25 7C9.25 8.65685 10.5931 10 12.25 10C13.9069 10 15.25 8.65685 15.25 7C15.25 5.34315 13.9069 4 12.25 4ZM7.25 7C7.25 4.23858 9.48858 2 12.25 2C15.0114 2 17.25 4.23858 17.25 7C17.25 9.76142 15.0114 12 12.25 12C9.48858 12 7.25 9.76142 7.25 7Z"
                fill="#97979B"
              />
            </svg>
          </div>
        </div>
        <span class="menuSpan" id="menuTutorialSpan">Tutorial</span>
      </div>
    </div>
  </div>
</div>

<script>
  console.log("main");

  var mainObj = new main();
  mainObj.init();

  function main() {
    this.init = function () {
      setAllUILang("main");

      $("#menu_main").css({ height: menuH });
      $("#body_main").css({ height: h - menuH });

      $("#menu_home").click(function () {
        mainObj.menuhome();
      });

      $("#menu_trade").click(function () {
        mainObj.menutrade();
      });

      $("#menu_wallet").click(function () {
        mainObj.menuwallet();
      });

      $("#menu_setting").click(function () {
        mainObj.menusetting();
      });
      $("#menu_tutorial").click(function () {
        mainObj.menuTutorial();
      });

      mResObj.showHtml("home.html", "body_main");
      mResObj.showHtml("trade.html", "body_main");
      mResObj.showHtml("wallet.html", "body_main");
      mResObj.showHtml("setting.html", "body_main");
    };

    this.menuhome = function () {
      unShowMenuPage();

      $(".menuOnClass").css({ display: "none" });
      $(".menuOffClass").css({ display: "block" });
      $("#menuHome").css({ display: "block" });
      $("#menuHome2").css({ display: "none" });
      $("#menuHomeSpan").css({ color: "var(--bg-foot)", "font-size": "12px" });
      $("#menuTradeSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuwalletSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuTutorialSpan").css({ color: "#97979B", "font-size": "12px" });
      $("#menuSettingSpan").css({ color: "#97979B", "font-size": "10px" });
      // $("#body_main").css({ "background-image": "url(pic/new_bg.png)" });
      $("#main").css({ "background-color": "#80DEEA" });
      homeObj.init();
      homeObj.call();
    };

    this.menutrade = function () {
      unShowMenuPage();

      $(".menuOnClass").css({ display: "none" });
      $(".menuOffClass").css({ display: "block" });
      $("#menuTrade").css({ display: "block" });
      $("#menuTrade2").css({ display: "none" });
      $("#menuHomeSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuTradeSpan").css({ color: "var(--bg-foot)", "font-size": "12px" });
      $("#menuTutorialSpan").css({ color: "#97979B", "font-size": "12px" });
      $("#menuwalletSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuSettingSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#main").css({ "background-color": "#F8BBD0" });

      tradeObj.init();
      tradeObj.call();
    };

    this.menuwallet = function () {
      unShowMenuPage();

      $(".menuOnClass").css({ display: "none" });
      $(".menuOffClass").css({ display: "block" });
      $("#menuwallet").css({ display: "block" });
      $("#menuwallet2").css({ display: "none" });
      $("#menuHomeSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuTradeSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuTutorialSpan").css({ color: "#97979B", "font-size": "12px" });
      $("#menuwalletSpan").css({
        color: "var(--bg-foot)",
        "font-size": "12px",
      });
      $("#menuSettingSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#main").css({ "background-color": "#DCEDC8" });

      walletObj.init();
      walletObj.call();
    };

    this.menusetting = function () {
      unShowMenuPage();

      $(".menuOnClass").css({ display: "none" });
      $(".menuOffClass").css({ display: "block" });
      $("#menuSetting").css({ display: "block" });
      $("#menuSetting2").css({ display: "none" });
      $("#menuHomeSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuTradeSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuwalletSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuTutorialSpan").css({ color: "#97979B", "font-size": "12px" });
      $("#menuSettingSpan").css({
        color: "var(--bg-foot)",
        "font-size": "12px",
      });
      $("#main").css({ "background-color": "#CFD8DC" });

      settingObj.init();
      settingObj.call();
    };

    this.menuTutorial = function () {
      unShowMenuPage();
      $(".menuOnClass").css({ display: "none" });
      $(".menuOffClass").css({ display: "block" });
      $("#menuTutorial").css({ display: "block" });
      $("#menuTutorial2").css({ display: "none" });
      $("#menuHomeSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuTradeSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuwalletSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuSettingSpan").css({ color: "#97979B", "font-size": "10px" });
      $("#menuTutorialSpan").css({
        color: "var(--bg-foot)",
        "font-size": "12px",
      });
      $("#main").css({ "background-color": "#CFD8DC" });

      tutorialObj.init();
      tutorialObj.call();
    };

    this.checkIsLogin = function () {
      getLocalToken();
      updateLoginStatus();
      if (token != null) {
        mainObj.refreshToken();
      } else {
        // pageShow("startPage");
        // pageShow("tutorialPage");
      }
    };

    function unShowMenuPage() {
      $(".menuPage").each(function () {
        $("#" + this.id).transition(
          {
            x: 0,
          },
          0
        );
      });
      $(".menuHeader").each(function () {
        $("#" + this.id).transition(
          {
            x: 0,
          },
          0
        );
      });
    }

    function updateLoginStatus() {
      var isLogin = false;
      if (token != null) {
        var nowTimeStamp = new Date().getTime();
        if (token.expire) {
          var expireTime = token.expire * 1000;
          if (nowTimeStamp < expireTime) {
            isLogin = true;
          } else {
            mainObj.refreshToken();
          }
        }
      }

      if (isLogin) {
        pageUnShow("loginPage");
        pageUnShow("startPage");
        mainObj.menuhome();
      } else {
        pageShow("startPage");
      }
    }

    function getLocalToken() {
      var tokenLocal = localStorage.getItem("token");
      if (tokenLocal != null) {
        token = JSON.parse(tokenLocal);
      }
    }

    var isRefreshTokenFinish = true;

    //30分钟刷新一次 รีเฟรชทุกๆ 30 นาที
    this.refreshToken = function () {
      if (refreshTokenTimer) {
        clearInterval(refreshTokenTimer);
      }
      refreshTokenTimer = setInterval(function () {
        refreshTokenFun();
      }, 1800000);
    };

    function refreshTokenFun() {
      if (token == null) {
        pageShow("startPage");
        return;
      }

      var mData = { token: token.refresh };

      isRefreshTokenFinish = false;

      $.ajax({
        type: "post",
        url: API_SERVER + "/v1/auth/refresh",
        data: JSON.stringify(mData),
        contentType: "application/json",
        dataType: "json",
        async: true,
        timeout: 100000,
        beforeSend: function (xmlhttprequest) {},
        success: function (data) {
          if (data.code == 0) {
            var tokenObj = data.result;
            localStorage.setItem("token", JSON.stringify(tokenObj));
            getLocalToken();
            isRefreshTokenFinish = true;
          } else {
            mainObj.checkAjaxResult(data.code);
          }
        },
        error: function (xmlhttprequest, error) {
          console.log(error);
        },
        complete: function () {},
      });
    }

    this.checkAjaxResult = function (code, fun4001) {
      switch (code) {
        case 4001:
          refreshTokenFun();
          if (fun4001) {
            fun4001();
          } else {
            logoutFun();
          }
          break;
        case 4002:
          logoutFun();
          break;
        case 4020:
          if (isRefreshTokenFinish) {
            Swal.fire({
              icon: "warning",
              showConfirmButton: false,
              title: `<span style='color:#1E232C;font-size: var(--text-size03);'><b id='main_device'></b></span>`,
              html:
                '<div style="display: flex;justify-content: space-between;align-items: center;">' +
                "</div>",
            });

            logoutFun();
          } else {
            refreshTokenFun();
          }
          break;
      }

      function logoutFun() {
        localStorage.removeItem("token");
        token = null;
        mainObj.checkIsLogin();
        if (heartBeatTimer) {
          clearInterval(heartBeatTimer);
        }
        if (refreshTokenTimer) {
          clearInterval(refreshTokenTimer);
        }
      }
    };
  }
</script>
